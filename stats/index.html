
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.js"></script>
        <script src="js/chartjs-plugin-piechart-outlabels.js"></script>
        <style type="text/css">
            @import url('https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900');
            body, html {
                color: #333538;
                font-family: 'Lato', sans-serif;
                line-height: 1.6;
                padding: 0;
                margin: 0;
            }

            a {
                color: #f27173;
                text-decoration: none;
            }

            a:hover {
                color: #e25f5f;
                text-decoration: underline;
            }

            .content {
                max-width: 800px;
                margin: auto;
                padding: 16px 32px;
            }

            .header {
                text-align: center;
                padding: 32px 0;
            }

            .wrapper {
                min-height: 400px;
                padding: 16px 0;
                position: relative;
            }

            .wrapper.col-2 {
                display: inline-block;
                min-height: 256px;
                width: 49%;
            }

            @media (max-width: 400px) {
                .wrapper.col-2 {
                    width: 100%
                }
            }

            .wrapper canvas {
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
            }

            .toolbar {
                display: flex;
            }

            .toolbar > * {
                margin: 0 8px 0 0;
            }

            .btn {
                background-color: #aaa;
                border-radius: 4px;
                color: white;
                padding: 0.25rem 0.75rem;
            }

            .btn .fa {
                font-size: 1rem;
            }

            .btn:hover {
                background-color: #888;
                color: white;
                text-decoration: none;
            }

            .btn-chartjs { background-color: #f27173; }
            .btn-chartjs:hover { background-color: #e25f5f; }
            .btn-docs:hover { background-color: #2793db; }
            .btn-docs { background-color: #36A2EB; }
            .btn-docs:hover { background-color: #2793db; }
            .btn-gh { background-color: #444; }
            .btn-gh:hover { background-color: #333; }

            .btn-on {
                border-style: inset;
            }

            .chartjs-title {
                font-size: 2rem;
                font-weight: 600;
                white-space: nowrap;
            }

            .chartjs-title::before {
                background-image: url(logo.svg);
                background-position: left center;
                background-repeat: no-repeat;
                background-size: 40px;
                content: 'Chart.js | ';
                color: #f27173;
                font-weight: 600;
                padding-left: 48px;
            }

            .chartjs-caption {
                font-size: 1.2rem;
            }

            .chartjs-links {
                display: flex;
                justify-content: center;
                padding: 8px 0;
            }

            .chartjs-links a {
                align-items: center;
                display: flex;
                font-size: 0.9rem;
                margin: 0.2rem;
            }

            .chartjs-links .fa:before {
                margin-right: 0.5em;
            }

            .samples-category {
                display: inline-block;
                margin-bottom: 32px;
                vertical-align: top;
                width: 25%;
            }

            .samples-category > .title {
                color: #aaa;
                font-weight: 300;
                font-size: 1.5rem;
            }

            .samples-category:hover > .title {
                color: black;
            }

            .samples-category > .items {
                padding: 8px 0;
            }

            .samples-entry {
                padding: 0 0 4px 0;
            }

            .samples-entry > .title {
                font-weight: 700;
            }

            @media (max-width: 640px) {
                .samples-category { width: 33%; }
            }

            @media (max-width: 512px) {
                .samples-category { width: 50%; }
            }

            @media (max-width: 420px) {
                .chartjs-caption { font-size: 1.05rem; }
                .chartjs-title::before { content: ''; }
                .chartjs-links a { flex-direction: column; }
                .chartjs-links .fa { margin: 0 }
                .samples-category { width: 100%; }
            }

            .analyser table {
                color: #333;
                font-size: 0.9rem;
                margin: 8px 0;
                width: 100%
            }

            .analyser th {
                background-color: #f0f0f0;
                padding: 2px;
            }

            .analyser td {
                padding: 2px;
                text-align: center;
            }
        </style>
        <style>
            canvas{
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
            }
        </style>
        <style type="text/css">/* Chart.js */
            @keyframes chartjs-render-animation{from{opacity:.99}to{opacity:1}}.chartjs-render-monitor{animation:chartjs-render-animation 1ms}.chartjs-size-monitor,.chartjs-size-monitor-expand,.chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}.chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}.chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}
        </style> 
    </head>
<body>
    <div class="content">
        <div class='wrapper'>
            <div class="chartjs-size-monitor">
                <div class="chartjs-size-monitor-expand">
                    <div class=""></div>
                </div>
                <div class="chartjs-size-monitor-shrink">
                    <div class=""></div>
                </div>
            </div>
            <canvas id="canvasDailyCases" style="display: block; height: 172px; width: 344px;" width="688" height="344" class="chartjs-render-monitor"></canvas>
            <canvas id="canvasDistributionBySex" style="display: block; height: 172px; width: 344px;" width="688" height="344" class="chartjs-render-monitor"></canvas>
            <canvas id="canvasFreqByGeneration" style="display: block; height: 172px; width: 344px;" width="688" height="344" class="chartjs-render-monitor"></canvas>
        </div>
    </div>
     
    <script>
        $.getJSON({
            url: 'https://covid19.geo-spatial.org/api/dashboard/getDailyCaseReport',
            success: function(data) {
                var _data = data.data.data;
                _datasets = []
                for (i=0; i<_data.length-1; i++) {
                    _datasets.push({x: _data[i]['day_case'],y: _data[i]['new_case_no']});
                }
                configDailyCases['data']['datasets'][0]['data'] = _datasets;
                var ctxDailyCases = document.getElementById('canvasDailyCases').getContext('2d');
                window.myLine = new Chart(ctxDailyCases, configDailyCases);
            }
        });

        $.getJSON({
            url: 'https://covid19.geo-spatial.org/api/statistics/getCaseRelations',
            success: function(data) {
                var _data = data.data.nodes;
                _women = 0;
                _men = 0;
                _total = _data.length;
                _silent75 = 0;
                _babyboomers74_56 = 0;
                _generationX55_40 = 0;
                _millenials39_24 = 0;
                _generationZ23_0 = 0;
                for (i=0; i<_data.length; i++) {
                    if (_data[i].properties.gender == 'BÄƒrbat') {
                        _men += 1;
                    } else {
                        _women += 1;
                    }

                    if (_data[i].properties.age >= 75) {
                        _silent75 += 1;
                    } else if (_data[i].properties.age < 75 && _data[i].properties.age >= 56) {
                        _babyboomers74_56 += 1;
                    } else if (_data[i].properties.age < 56 && _data[i].properties.age >= 40) {
                        _generationX55_40 += 1;
                    } else if (_data[i].properties.age < 40 && _data[i].properties.age >= 24) {
                        _millenials39_24 += 1;
                    } else if (_data[i].properties.age < 23) {
                        _generationZ23_0 += 1;
                    }
                }
                configDistributionBySex.data.datasets[0].data = [
                    ((_women*100)/_total).toFixed(2), 
                    ((_men*100)/_total).toFixed(2)
                ];
                configFreqByGeneration.data.datasets[0].data = [
                    ((_silent75*100)/_total).toFixed(2),
                    ((_babyboomers74_56*100)/_total).toFixed(2),
                    ((_generationX55_40*100)/_total).toFixed(2),
                    ((_millenials39_24*100)/_total).toFixed(2),
                    ((_generationZ23_0*100)/_total).toFixed(2)
                ];
                var ctxDBS = document.getElementById('canvasDistributionBySex').getContext('2d');
                window.myLine = new Chart(ctxDBS, configDistributionBySex);
                var ctxFBG = document.getElementById('canvasFreqByGeneration').getContext('2d');
                window.myLine = new Chart(ctxFBG, configFreqByGeneration);
            }
        });

        window.chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgb(75, 192, 192)',
            blue: 'rgb(54, 162, 235)',
            purple: 'rgb(153, 102, 255)',
            grey: 'rgb(201, 203, 207)'
        };
        var configFreqByGeneration = {
            type: 'outlabeledPie',
            data: {
                labels: ['The Silent Generation', 'Baby Boomers', 'Generation X', 'Millennials', 'Generation Z'],
                datasets: [{
                    backgroundColor: [window.chartColors.orange, window.chartColors.green, window.chartColors.yellow, window.chartColors.red, window.chartColors.blue ],
                    data: []
                }]
            },
            options: {
                repsonsive: true,
                title: {
					display: true,
                    text: 'Frecventa dupa generatie (%)',
                    fontSize: 18
                },
                legend: {
                    display: false
                },
                display: true,
			    elements: {
			    }
            },
            plugins: {
                legend: false,
                outlabels: {
                text: '%l %p',
                color: 'white',
                stretch: 45,
                font: {
                    resizable: true,
                    minSize: 12,
                    maxSize: 18
                }
                }
            }
       }

       var configDistributionBySex = {
            type: 'doughnut',
            data: {
                labels: ['Feminin', 'Masculin'],
                datasets: [{
                    backgroundColor: [window.chartColors.red, window.chartColors.blue],
                    data: []
                }]
            },
            options: {
                repsonsive: true,
                title: {
					display: true,
                    text: 'Distributie dupa gen (%)',
                    fontSize: 18
                },
                legend: {
                    display: false
                },
                display: true,
			    elements: {
			    }
            }
       }
       var configDailyCases = {
			type: 'line',
			data: {
				//labels: [],
				datasets: [{
					label: 'Cazuri unice',
					backgroundColor: window.chartColors.blue,
					borderColor: window.chartColors.blue,
					data: [],
					fill: false,
                    borderColor: window.chartColors.blue
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
                    text: 'Cazuri pe zile',
                    fontSize: 18
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
                        type: 'time',
                        time: {
                            format: 'YYYY-MM-DD',
                            tooltipFormat: 'll',
                            unit: 'day',
                            unitStepSize: 5
                        },
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Data'
						}
					}],
					yAxes: [{
						//display: true,
						scaleLabel: {
							display: true,
							labelString: 'Cazuri'
						}
					}]
				}
			}
		};


    </script>
</body>
</html>
